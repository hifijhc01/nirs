#!/usr/bin/env bash
set -Eeuo pipefail

# 1) artifacts 이미지 안에 "서버 홈 형태"를 만들어 준다.
#    runtime 단계의 Dockerfile/BuildConfig가 /server 또는 /opt/server를 참조하므로,
#    둘 다 충족시키도록 실제 디렉터리는 /server 로 만들고 /opt/server는 심볼릭 링크로 연결한다.
mkdir -p /server/standalone/deployments
ln -sfn /server /opt/server

# 2) WAR 복사
SRC_DIR="${S2I_SOURCE_DIR:-/tmp/src}"
cp -f "${SRC_DIR}/ROOT.war" /server/standalone/deployments/ROOT.war

# 3) 퍼미션 (랜덤 UID 대비)
chmod -R g+rwX /server

